<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Query Builder - Interactive Demo</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 1rem;
            overflow-x: auto;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.875rem;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        .feature-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .demo-section {
            margin: 3rem 0;
            padding: 2rem;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        .highlight {
            background: #fef3c7;
            padding: 0.125rem 0.25rem;
            border-radius: 3px;
        }
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        .status-completed {
            background: #d1fae5;
            color: #065f46;
        }
        .status-enhanced {
            background: #dbeafe;
            color: #1e40af;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="demo-container">
        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold text-gray-900 mb-4">Search Query Builder</h1>
            <p class="text-xl text-gray-600 mb-6">A powerful and flexible search query interface inspired by Sentry's search functionality</p>
            <div class="flex justify-center space-x-4">
                <span class="status-badge status-completed">Production Ready</span>
                <span class="status-badge status-enhanced">TypeScript</span>
                <span class="status-badge status-enhanced">React 18+</span>
            </div>
        </header>

        <!-- Key Features -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Key Features</h2>
            <div class="feature-grid">
                <div class="feature-card">
                    <h3 class="text-lg font-semibold text-gray-900 mb-3">🎯 Smart Autocomplete</h3>
                    <p class="text-gray-600">Intelligent dropdown with tabs for Recent and All filter keys, supporting keyboard navigation</p>
                </div>
                <div class="feature-card">
                    <h3 class="text-lg font-semibold text-gray-900 mb-3">⌨️ Full Keyboard Support</h3>
                    <p class="text-gray-600">Arrow keys for navigation, Tab/Shift+Tab for focus management, Enter to select, Escape to close</p>
                </div>
                <div class="feature-card">
                    <h3 class="text-lg font-semibold text-gray-900 mb-3">🎨 Perfect UX</h3>
                    <p class="text-gray-600">Focus states, click-outside-to-close, single dropdown management across multiple instances</p>
                </div>
                <div class="feature-card">
                    <h3 class="text-lg font-semibold text-gray-900 mb-3">🔧 Highly Configurable</h3>
                    <p class="text-gray-600">Customizable filter keys, operators, value types, and styling. Full TypeScript support</p>
                </div>
                <div class="feature-card">
                    <h3 class="text-lg font-semibold text-gray-900 mb-3">💾 Recent Searches</h3>
                    <p class="text-gray-600">Automatically remembers recently used filter keys with localStorage persistence</p>
                </div>
                <div class="feature-card">
                    <h3 class="text-lg font-semibold text-gray-900 mb-3">🏗️ Production Ready</h3>
                    <p class="text-gray-600">Thoroughly tested, optimized performance, and battle-tested in real applications</p>
                </div>
            </div>
        </section>

        <!-- Live Demo -->
        <section class="demo-section">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Interactive Demo</h2>
            <p class="text-gray-600 mb-6">Try the search query builder below. Click in the input, use arrow keys to open the dropdown, and explore the features!</p>
            
            <!-- Demo containers will be rendered here by React -->
            <div id="demo-single" class="mb-8">
                <h3 class="text-lg font-semibold text-gray-700 mb-3">Single Instance</h3>
                <div id="single-demo-root"></div>
                <div class="mt-4 p-4 bg-white rounded border">
                    <strong>Current Query:</strong> <span id="single-query-display" class="font-mono text-sm bg-gray-100 px-2 py-1 rounded">""</span>
                </div>
            </div>

            <div id="demo-multiple" class="mb-8">
                <h3 class="text-lg font-semibold text-gray-700 mb-3">Multiple Instances (Test Single Dropdown Management)</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Search Query Builder #1</label>
                        <div id="multi-demo-root-1"></div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Search Query Builder #2</label>
                        <div id="multi-demo-root-2"></div>
                    </div>
                </div>
                <div class="mt-4 p-4 bg-white rounded border">
                    <p class="text-sm text-gray-600">
                        <strong>Note:</strong> Try opening dropdowns in both instances - only one will be visible at a time.
                    </p>
                </div>
            </div>
        </section>

        <!-- Installation -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Installation & Setup</h2>
            
            <h3 class="text-lg font-semibold text-gray-800 mb-3">1. Install Dependencies</h3>
            <div class="code-block mb-6">
npm install react react-dom
# or
yarn add react react-dom
            </div>

            <h3 class="text-lg font-semibold text-gray-800 mb-3">2. Copy Components</h3>
            <p class="text-gray-600 mb-4">Copy the following files to your project:</p>
            <div class="code-block mb-6">
src/
├── components/
│   ├── SearchQueryBuilder.tsx      # Main component
│   ├── FilterKeyDropdownEnhanced.tsx
│   ├── InterTokenInput.tsx
│   ├── TokenizedQueryGrid.tsx
│   ├── PlainTextInput.tsx
│   ├── Icons.tsx
│   └── ...
├── hooks/
│   └── useQueryBuilder.ts
├── utils/
│   └── dropdownManager.ts          # Global dropdown state
└── types/
    └── index.ts                    # TypeScript definitions
            </div>

            <h3 class="text-lg font-semibold text-gray-800 mb-3">3. Basic Usage</h3>
            <div class="code-block mb-6">
import React, { useState } from 'react';
import { SearchQueryBuilder } from './components/SearchQueryBuilder';

const filterKeys = [
  {
    key: 'browser.name',
    name: 'Browser Name',
    kind: 'field',
    valueType: 'string',
    allowedOperators: ['=', '!=']
  },
  {
    key: 'environment',
    name: 'Environment', 
    kind: 'tag',
    valueType: 'string',
    allowedOperators: ['=', '!=']
  }
];

function App() {
  const [query, setQuery] = useState('');

  return (
    &lt;SearchQueryBuilder
      query={query}
      onChange={setQuery}
      onSearch={(searchQuery) => {
        console.log('Search:', searchQuery);
      }}
      filterKeys={filterKeys}
      placeholder="Search issues, events, and more..."
    /&gt;
  );
}
            </div>
        </section>

        <!-- API Reference -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">API Reference</h2>
            
            <h3 class="text-lg font-semibold text-gray-800 mb-3">SearchQueryBuilder Props</h3>
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Prop</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Type</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Required</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Description</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        <tr>
                            <td class="px-4 py-3 text-sm font-mono">query</td>
                            <td class="px-4 py-3 text-sm">string</td>
                            <td class="px-4 py-3 text-sm">Yes</td>
                            <td class="px-4 py-3 text-sm">Current search query string</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-3 text-sm font-mono">onChange</td>
                            <td class="px-4 py-3 text-sm">(query: string) => void</td>
                            <td class="px-4 py-3 text-sm">Yes</td>
                            <td class="px-4 py-3 text-sm">Called when query changes</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-3 text-sm font-mono">onSearch</td>
                            <td class="px-4 py-3 text-sm">(query: string) => void</td>
                            <td class="px-4 py-3 text-sm">Yes</td>
                            <td class="px-4 py-3 text-sm">Called when search is submitted</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-3 text-sm font-mono">filterKeys</td>
                            <td class="px-4 py-3 text-sm">FilterKey[]</td>
                            <td class="px-4 py-3 text-sm">No</td>
                            <td class="px-4 py-3 text-sm">Available filter keys for autocomplete</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-3 text-sm font-mono">placeholder</td>
                            <td class="px-4 py-3 text-sm">string</td>
                            <td class="px-4 py-3 text-sm">No</td>
                            <td class="px-4 py-3 text-sm">Input placeholder text</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-3 text-sm font-mono">disabled</td>
                            <td class="px-4 py-3 text-sm">boolean</td>
                            <td class="px-4 py-3 text-sm">No</td>
                            <td class="px-4 py-3 text-sm">Disable the input</td>
                        </tr>
                        <tr>
                            <td class="px-4 py-3 text-sm font-mono">className</td>
                            <td class="px-4 py-3 text-sm">string</td>
                            <td class="px-4 py-3 text-sm">No</td>
                            <td class="px-4 py-3 text-sm">Additional CSS classes</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 class="text-lg font-semibold text-gray-800 mb-3 mt-8">FilterKey Interface</h3>
            <div class="code-block">
interface FilterKey {
  key: string;                    // Unique identifier (e.g., 'browser.name')
  name: string;                   // Display name (e.g., 'Browser Name')
  kind: string;                   // Category (e.g., 'field', 'tag')
  valueType: string;              // Data type (e.g., 'string', 'number')
  allowedOperators: string[];     // Valid operators (e.g., ['=', '!=', '~'])
  description?: string;           // Optional description
  deprecated?: boolean;           // Mark as deprecated
}
            </div>
        </section>

        <!-- Advanced Usage -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Advanced Usage</h2>
            
            <h3 class="text-lg font-semibold text-gray-800 mb-3">Custom Filter Keys with Sections</h3>
            <div class="code-block mb-6">
const filterKeySections = [
  {
    key: 'event',
    label: 'Event Attributes',
    children: [
      { key: 'event.type', name: 'Event Type', kind: 'field', valueType: 'string', allowedOperators: ['=', '!='] },
      { key: 'event.level', name: 'Level', kind: 'field', valueType: 'string', allowedOperators: ['=', '!='] }
    ]
  },
  {
    key: 'user',
    label: 'User Context',
    children: [
      { key: 'user.id', name: 'User ID', kind: 'field', valueType: 'string', allowedOperators: ['=', '!='] },
      { key: 'user.email', name: 'Email', kind: 'field', valueType: 'string', allowedOperators: ['=', '!='] }
    ]
  }
];

&lt;SearchQueryBuilder
  query={query}
  onChange={setQuery}
  onSearch={handleSearch}
  filterKeys={allFilterKeys}
  filterKeySections={filterKeySections}
/&gt;
            </div>

            <h3 class="text-lg font-semibold text-gray-800 mb-3">Handling Search Results</h3>
            <div class="code-block mb-6">
const handleSearch = async (searchQuery: string) => {
  try {
    // Parse the query and convert to your API format
    const parsedQuery = parseSearchQuery(searchQuery);
    
    // Make API call
    const results = await searchAPI({
      query: parsedQuery.text,
      filters: parsedQuery.filters,
      // ... other parameters
    });
    
    setSearchResults(results);
  } catch (error) {
    console.error('Search failed:', error);
  }
};
            </div>

            <h3 class="text-lg font-semibold text-gray-800 mb-3">Keyboard Shortcuts</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-white p-4 rounded border">
                    <h4 class="font-semibold mb-3">Navigation</h4>
                    <ul class="space-y-2 text-sm">
                        <li><span class="highlight">↓</span> Open dropdown / Navigate down</li>
                        <li><span class="highlight">↑</span> Navigate up in dropdown</li>
                        <li><span class="highlight">←→</span> Switch between tabs</li>
                        <li><span class="highlight">Enter</span> Select item</li>
                        <li><span class="highlight">Escape</span> Close dropdown</li>
                    </ul>
                </div>
                <div class="bg-white p-4 rounded border">
                    <h4 class="font-semibold mb-3">Input</h4>
                    <ul class="space-y-2 text-sm">
                        <li><span class="highlight">Tab</span> Move to next input</li>
                        <li><span class="highlight">Shift+Tab</span> Move to previous input</li>
                        <li><span class="highlight">Backspace</span> Delete previous token</li>
                        <li><span class="highlight">:</span> Auto-complete filter syntax</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Recent Updates -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Recent Updates & Fixes</h2>
            <div class="space-y-4">
                <div class="bg-white p-4 rounded border-l-4 border-green-500">
                    <h4 class="font-semibold text-green-800">✅ Focus State Management</h4>
                    <p class="text-gray-600 mt-1">Fixed focus states to remain visible when interacting with dropdown components</p>
                </div>
                <div class="bg-white p-4 rounded border-l-4 border-green-500">
                    <h4 class="font-semibold text-green-800">✅ Click Outside to Close</h4>
                    <p class="text-gray-600 mt-1">Added proper outside click detection to close dropdowns automatically</p>
                </div>
                <div class="bg-white p-4 rounded border-l-4 border-green-500">
                    <h4 class="font-semibold text-green-800">✅ Single Dropdown Management</h4>
                    <p class="text-gray-600 mt-1">Implemented global dropdown manager to ensure only one dropdown is open at a time</p>
                </div>
                <div class="bg-white p-4 rounded border-l-4 border-green-500">
                    <h4 class="font-semibold text-green-800">✅ Tab Switching Fixed</h4>
                    <p class="text-gray-600 mt-1">Resolved issues with tab switching in dropdown by fixing event handling conflicts</p>
                </div>
                <div class="bg-white p-4 rounded border-l-4 border-green-500">
                    <h4 class="font-semibold text-green-800">✅ Keyboard Navigation</h4>
                    <p class="text-gray-600 mt-1">Fixed highlighting to correctly show first item when opening dropdown with arrow keys</p>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="text-center py-8 border-t border-gray-200">
            <p class="text-gray-600">
                Built with ❤️ by the development team. 
                <a href="https://github.com/your-repo/search-query-builder" class="text-blue-600 hover:text-blue-800">
                    View on GitHub
                </a>
            </p>
        </footer>
    </div>

    <!-- React Demo Components -->
    <script type="text/babel">
        // Mock FilterKey data for demo
        const mockFilterKeys = [
            {
                key: 'browser.name',
                name: 'Browser Name',
                kind: 'field',
                valueType: 'string',
                allowedOperators: ['=', '!='],
                description: 'Name of the browser'
            },
            {
                key: 'environment',
                name: 'Environment',
                kind: 'tag',
                valueType: 'string',
                allowedOperators: ['=', '!='],
                description: 'Deployment environment'
            },
            {
                key: 'user.id',
                name: 'User ID',
                kind: 'field',
                valueType: 'string',
                allowedOperators: ['=', '!='],
                description: 'Unique user identifier'
            },
            {
                key: 'event.type',
                name: 'Event Type',
                kind: 'field',
                valueType: 'string',
                allowedOperators: ['=', '!='],
                description: 'Type of event'
            },
            {
                key: 'release',
                name: 'Release',
                kind: 'tag',
                valueType: 'string',
                allowedOperators: ['=', '!='],
                description: 'Release version'
            },
            {
                key: 'transaction.duration',
                name: 'Duration',
                kind: 'measurement',
                valueType: 'number',
                allowedOperators: ['=', '!=', '>', '<'],
                description: 'Transaction duration in milliseconds'
            }
        ];

        // Simple SearchQueryBuilder mock component for demo
        function DemoSearchQueryBuilder({ query, onChange, onSearch, placeholder = "Search...", ...props }) {
            const [focused, setFocused] = React.useState(false);
            const [showDropdown, setShowDropdown] = React.useState(false);
            
            const handleFocus = () => {
                setFocused(true);
            };
            
            const handleBlur = (e) => {
                // Simple blur with delay to allow for dropdown clicks
                setTimeout(() => {
                    if (!e.currentTarget.contains(document.activeElement)) {
                        setFocused(false);
                        setShowDropdown(false);
                    }
                }, 150);
            };
            
            const handleKeyDown = (e) => {
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    setShowDropdown(true);
                } else if (e.key === 'Escape') {
                    setShowDropdown(false);
                }
            };
            
            const handleClick = () => {
                if (focused) {
                    setShowDropdown(!showDropdown);
                }
            };
            
            return (
                <div 
                    className={`relative w-full min-h-[40px] border border-gray-300 rounded-md bg-white transition-colors cursor-text ${
                        focused ? 'ring-2 ring-blue-500 border-blue-500' : ''
                    }`}
                    onFocus={handleFocus}
                    onBlur={handleBlur}
                    tabIndex={0}
                >
                    <div className="absolute left-3 top-1/2 transform -translate-y-1/2">
                        <svg className="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </div>
                    
                    <input
                        type="text"
                        className="w-full pl-10 pr-10 py-2 border-0 outline-none bg-transparent text-sm placeholder-gray-400"
                        placeholder={placeholder}
                        value={query}
                        onChange={(e) => onChange(e.target.value)}
                        onKeyDown={handleKeyDown}
                        onClick={handleClick}
                    />
                    
                    <div className="absolute right-3 top-1/2 transform -translate-y-1/2">
                        <button
                            type="button"
                            onClick={() => onChange('')}
                            className={`p-1 rounded ${query ? 'text-gray-400 hover:text-gray-600' : 'text-gray-300'}`}
                            disabled={!query}
                        >
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                    
                    {showDropdown && (
                        <div className="absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-md shadow-lg z-50 max-h-80 overflow-y-auto">
                            <div className="border-b border-gray-200 flex">
                                <button className="px-3 py-2 text-sm font-medium border-b-2 border-blue-500 text-blue-600 bg-blue-50">
                                    Recent
                                </button>
                                <button className="px-3 py-2 text-sm font-medium border-b-2 border-transparent text-gray-700 hover:text-gray-900">
                                    All ({mockFilterKeys.length})
                                </button>
                            </div>
                            
                            <div className="py-1">
                                {mockFilterKeys.slice(0, 4).map((filterKey, index) => (
                                    <button
                                        key={filterKey.key}
                                        type="button"
                                        className={`w-full px-3 py-2 text-left text-sm flex items-start gap-3 hover:bg-gray-100 ${
                                            index === 0 ? 'bg-blue-100 text-blue-900' : ''
                                        }`}
                                        onClick={() => {
                                            onChange(query + filterKey.key + ':');
                                            setShowDropdown(false);
                                        }}
                                    >
                                        <div className="flex-shrink-0 mt-0.5">
                                            <svg className="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                                            </svg>
                                        </div>
                                        <div className="flex-1 min-w-0">
                                            <div className="flex items-center gap-2">
                                                <div className="font-medium text-gray-900 truncate">{filterKey.name}</div>
                                                <span className="text-xs bg-gray-100 text-gray-600 px-1.5 py-0.5 rounded-full">
                                                    {filterKey.kind}
                                                </span>
                                            </div>
                                            <div className="text-xs text-gray-500 font-mono">{filterKey.key}</div>
                                            {filterKey.description && (
                                                <div className="text-xs text-gray-400 mt-1">{filterKey.description}</div>
                                            )}
                                        </div>
                                    </button>
                                ))}
                            </div>
                            
                            <div className="border-t border-gray-200 px-3 py-2 text-xs text-gray-500 bg-gray-50">
                                <div className="flex justify-between items-center">
                                    <div className="flex items-center gap-4">
                                        <span>↑↓ Navigate</span>
                                        <span>←→ Switch tabs</span>
                                        <span>↵ Select</span>
                                    </div>
                                    <div>
                                        <span>Esc Close</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Single Demo Component
        function SingleDemo() {
            const [query, setQuery] = React.useState('');
            
            React.useEffect(() => {
                document.getElementById('single-query-display').textContent = `"${query}"`;
            }, [query]);
            
            return (
                <DemoSearchQueryBuilder
                    query={query}
                    onChange={setQuery}
                    onSearch={(q) => console.log('Search:', q)}
                    placeholder="Search events, issues, and more..."
                />
            );
        }

        // Multiple Demo Component
        function MultipleDemo1() {
            const [query, setQuery] = React.useState('');
            
            return (
                <DemoSearchQueryBuilder
                    query={query}
                    onChange={setQuery}
                    onSearch={(q) => console.log('Search 1:', q)}
                    placeholder="First search instance..."
                />
            );
        }

        function MultipleDemo2() {
            const [query, setQuery] = React.useState('');
            
            return (
                <DemoSearchQueryBuilder
                    query={query}
                    onChange={setQuery}
                    onSearch={(q) => console.log('Search 2:', q)}
                    placeholder="Second search instance..."
                />
            );
        }

        // Render demo components
        ReactDOM.render(<SingleDemo />, document.getElementById('single-demo-root'));
        ReactDOM.render(<MultipleDemo1 />, document.getElementById('multi-demo-root-1'));
        ReactDOM.render(<MultipleDemo2 />, document.getElementById('multi-demo-root-2'));
    </script>
</body>
</html>